# frozen_string_literal: true

require 'number_to_kanji'

module JapaneseAddressParser
  module AddressParser
    module TownAndAfterNormalizer
      OLD_NEW_KAMJI_MAPPING = {
        亞: '亜',
        圍: '囲',
        壹: '壱',
        榮: '栄',
        驛: '駅',
        應: '応',
        櫻: '桜',
        假: '仮',
        會: '会',
        懷: '懐',
        覺: '覚',
        樂: '楽',
        陷: '陥',
        歡: '歓',
        氣: '気',
        戲: '戯',
        據: '拠',
        挾: '挟',
        區: '区',
        徑: '径',
        溪: '渓',
        輕: '軽',
        藝: '芸',
        儉: '倹',
        圈: '圏',
        權: '権',
        嚴: '厳',
        恆: '恒',
        國: '国',
        齋: '斎',
        雜: '雑',
        蠶: '蚕',
        殘: '残',
        兒: '児',
        實: '実',
        釋: '釈',
        從: '従',
        縱: '縦',
        敍: '叙',
        燒: '焼',
        條: '条',
        剩: '剰',
        壤: '壌',
        釀: '醸',
        眞: '真',
        盡: '尽',
        醉: '酔',
        髓: '髄',
        聲: '声',
        竊: '窃',
        淺: '浅',
        錢: '銭',
        禪: '禅',
        爭: '争',
        插: '挿',
        騷: '騒',
        屬: '属',
        對: '対',
        滯: '滞',
        擇: '択',
        單: '単',
        斷: '断',
        癡: '痴',
        鑄: '鋳',
        敕: '勅',
        鐵: '鉄',
        傳: '伝',
        黨: '党',
        鬪: '闘',
        屆: '届',
        腦: '脳',
        廢: '廃',
        發: '発',
        蠻: '蛮',
        拂: '払',
        邊: '辺',
        瓣: '弁',
        寶: '宝',
        沒: '没',
        滿: '満',
        藥: '薬',
        餘: '余',
        樣: '様',
        亂: '乱',
        兩: '両',
        禮: '礼',
        靈: '霊',
        爐: '炉',
        灣: '湾',
        惡: '悪',
        醫: '医',
        飮: '飲',
        營: '営',
        圓: '円',
        歐: '欧',
        奧: '奥',
        價: '価',
        繪: '絵',
        擴: '拡',
        學: '学',
        罐: '缶',
        勸: '勧',
        觀: '観',
        歸: '帰',
        犧: '犠',
        擧: '挙',
        狹: '狭',
        驅: '駆',
        莖: '茎',
        經: '経',
        繼: '継',
        缺: '欠',
        劍: '剣',
        檢: '検',
        顯: '顕',
        廣: '広',
        鑛: '鉱',
        碎: '砕',
        劑: '剤',
        參: '参',
        慘: '惨',
        絲: '糸',
        辭: '辞',
        舍: '舎',
        壽: '寿',
        澁: '渋',
        肅: '粛',
        將: '将',
        證: '証',
        乘: '乗',
        疊: '畳',
        孃: '嬢',
        觸: '触',
        寢: '寝',
        圖: '図',
        穗: '穂',
        樞: '枢',
        齊: '斉',
        攝: '摂',
        戰: '戦',
        潛: '潜',
        雙: '双',
        莊: '荘',
        裝: '装',
        藏: '蔵',
        續: '続',
        體: '体',
        臺: '台',
        澤: '沢',
        膽: '胆',
        彈: '弾',
        蟲: '虫',
        廳: '庁',
        鎭: '鎮',
        點: '点',
        燈: '灯',
        盜: '盗',
        獨: '独',
        貳: '弐',
        霸: '覇',
        賣: '売',
        髮: '髪',
        祕: '秘',
        佛: '仏',
        變: '変',
        辯: '弁',
        豐: '豊',
        飜: '翻',
        默: '黙',
        與: '与',
        譽: '誉',
        謠: '謡',
        覽: '覧',
        獵: '猟',
        勵: '励',
        齡: '齢',
        勞: '労',
        壓: '圧',
        爲: '為',
        隱: '隠',
        衞: '衛',
        鹽: '塩',
        毆: '殴',
        穩: '穏',
        畫: '画',
        壞: '壊',
        殼: '殻',
        嶽: '岳',
        卷: '巻',
        關: '関',
        顏: '顔',
        僞: '偽',
        舊: '旧',
        峽: '峡',
        曉: '暁',
        勳: '勲',
        惠: '恵',
        螢: '蛍',
        鷄: '鶏',
        縣: '県',
        險: '険',
        獻: '献',
        驗: '験',
        效: '効',
        號: '号',
        濟: '済',
        册: '冊',
        棧: '桟',
        贊: '賛',
        齒: '歯',
        濕: '湿',
        寫: '写',
        收: '収',
        獸: '獣',
        處: '処',
        稱: '称',
        奬: '奨',
        淨: '浄',
        繩: '縄',
        讓: '譲',
        囑: '嘱',
        愼: '慎',
        粹: '粋',
        隨: '随',
        數: '数',
        靜: '静',
        專: '専',
        踐: '践',
        纖: '繊',
        壯: '壮',
        搜: '捜',
        總: '総',
        臟: '臓',
        墮: '堕',
        帶: '帯',
        瀧: '滝',
        擔: '担',
        團: '団',
        遲: '遅',
        晝: '昼',
        聽: '聴',
        遞: '逓',
        轉: '転',
        當: '当',
        稻: '稲',
        讀: '読',
        惱: '悩',
        拜: '拝',
        麥: '麦',
        拔: '抜',
        濱: '浜',
        竝: '並',
        辨: '弁',
        舖: '舗',
        襃: '褒',
        萬: '万',
        譯: '訳',
        豫: '予',
        搖: '揺',
        來: '来',
        龍: '竜',
        壘: '塁',
        隸: '隷',
        戀: '恋',
        樓: '楼',
        鰺: '鯵',
        鶯: '鴬',
        蠣: '蛎',
        攪: '撹',
        竈: '竃',
        灌: '潅',
        諫: '諌',
        頸: '頚',
        礦: '砿',
        蘂: '蕊',
        靱: '靭',
        賤: '賎',
        壺: '壷',
        礪: '砺',
        檮: '梼',
        濤: '涛',
        邇: '迩',
        蠅: '蝿',
        檜: '桧',
        儘: '侭',
        藪: '薮',
        籠: '篭'
      }.freeze
      OLD_KANJIS = ::JapaneseAddressParser::AddressParser::TownAndAfterNormalizer::OLD_NEW_KAMJI_MAPPING.keys.freeze

      public_constant :OLD_NEW_KAMJI_MAPPING
      public_constant :OLD_KANJIS

      def call(town_and_after)
        # 旧字体を新字体に置き換える。
        normalized =
          town_and_after.gsub(/[#{::JapaneseAddressParser::AddressParser::TownAndAfterNormalizer::OLD_KANJIS.join}]/) do |old_kanji|
            ::JapaneseAddressParser::AddressParser::TownAndAfterNormalizer::OLD_NEW_KAMJI_MAPPING[old_kanji.to_sym]
          end

        # 全角の数字を半角に変換する。
        normalized = normalized.tr('０-９', '0-9')

        # ハイフンのような文字をハイフンに変換する。
        normalized = normalized.gsub(/[‐－―ー−]/, '-')

        # 「3条」のような表記に含まれる英数字を漢数字に変換する。
        normalized.gsub(/(\D*)(\d*)([条|丁目].*)/) do
          if ::Regexp.last_match(2).empty?
            normalized
          else
            "#{::Regexp.last_match(1)}#{::NumberToKanji.call(Integer(::Regexp.last_match(2), 10))}#{::Regexp.last_match(3)}"
          end
        end
      end

      module_function :call
    end
  end
end
